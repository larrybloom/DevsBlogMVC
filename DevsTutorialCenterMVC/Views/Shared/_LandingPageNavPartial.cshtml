@using System.Security.Claims
@{
    var user = Context.User;
}

<nav class="bg-white shadow">
    <div class="container">
        <div class="flex items-center justify-between h-20">
            <div class="flex items-center justify-between w-full">
                <a href="/" class="flex items-center">
                    <svg class="h-16" viewBox="0 0 48 48" fill="none" xmlns="http://www.w3.org/2000/svg">
                        <path fill-rule="evenodd" clip-rule="evenodd"
                              d="M36.666 21.844L36.446 21.4L36.09 21.12C35.62 20.752 33.244 21.142 32.606 20.564C32.15 20.148 32.08 19.396 31.946 18.384C31.9147 17.4296 31.6672 16.4948 31.222 15.65C30.5724 14.5005 29.6757 13.5095 28.5966 12.7486C27.5175 11.9877 26.2829 11.4759 24.982 11.25H19.334C17.1959 11.2558 15.1467 12.106 13.6326 13.6156C12.1185 15.1253 11.2621 17.1719 11.25 19.31V28.7C11.2632 30.8368 12.1202 32.8818 13.6344 34.3896C15.1485 35.8974 17.1972 36.7458 19.334 36.75H28.612C30.7461 36.7427 32.7912 35.8939 34.3032 34.3878C35.8153 32.8818 36.6722 30.8401 36.688 28.706L36.728 23.356L36.738 22.198L36.666 21.844ZM19.436 17.834H23.916C24.3247 17.834 24.7167 17.9964 25.0057 18.2853C25.2946 18.5743 25.457 18.9663 25.457 19.375C25.457 19.7837 25.2946 20.1757 25.0057 20.4647C24.7167 20.7536 24.3247 20.916 23.916 20.916H19.436C19.0273 20.916 18.6353 20.7536 18.3463 20.4647C18.0574 20.1757 17.895 19.7837 17.895 19.375C17.895 18.9663 18.0574 18.5743 18.3463 18.2853C18.6353 17.9964 19.0273 17.834 19.436 17.834ZM28.536 30.084H19.436C19.0382 30.084 18.6566 29.926 18.3753 29.6447C18.094 29.3634 17.936 28.9818 17.936 28.584C17.936 28.1862 18.094 27.8046 18.3753 27.5233C18.6566 27.242 19.0382 27.084 19.436 27.084H28.536C28.9338 27.084 29.3154 27.242 29.5967 27.5233C29.878 27.8046 30.036 28.1862 30.036 28.584C30.036 28.9818 29.878 29.3634 29.5967 29.6447C29.3154 29.926 28.9338 30.084 28.536 30.084Z"
                              fill="#A6F4C5"/>
                        <path
                            d="M28.534 27.084H19.346C18.9482 27.0959 18.5714 27.2654 18.2985 27.5551C18.0256 27.8449 17.8791 28.2312 17.891 28.629C17.9029 29.0268 18.0724 29.4036 18.3622 29.6765C18.6519 29.9493 19.0382 30.0959 19.436 30.084H28.61C28.807 30.079 29.001 30.0353 29.1811 29.9553C29.3612 29.8753 29.5238 29.7606 29.6595 29.6178C29.7953 29.475 29.9016 29.3068 29.9724 29.1229C30.0431 28.939 30.077 28.743 30.072 28.546C30.067 28.349 30.0233 28.1549 29.9433 27.9749C29.8633 27.7948 29.7486 27.6322 29.6058 27.4965C29.463 27.3607 29.2948 27.2544 29.1109 27.1836C28.927 27.1129 28.731 27.079 28.534 27.084ZM19.436 20.916H23.916C24.3247 20.916 24.7167 20.7536 25.0056 20.4646C25.2946 20.1756 25.457 19.7837 25.457 19.375C25.457 18.9663 25.2946 18.5743 25.0056 18.2853C24.7167 17.9963 24.3247 17.834 23.916 17.834H19.436C19.0273 17.834 18.6353 17.9963 18.3463 18.2853C18.0573 18.5743 17.895 18.9663 17.895 19.375C17.895 19.7837 18.0573 20.1756 18.3463 20.4646C18.6353 20.7536 19.0273 20.916 19.436 20.916Z"
                            fill="#34A853"/>
                        <path
                            d="M39 4H9C7.67392 4 6.40215 4.52678 5.46447 5.46447C4.52678 6.40215 4 7.67392 4 9V39C4 40.3261 4.52678 41.5979 5.46447 42.5355C6.40215 43.4732 7.67392 44 9 44H39C40.3261 44 41.5979 43.4732 42.5355 42.5355C43.4732 41.5979 44 40.3261 44 39V9C44 7.67392 43.4732 6.40215 42.5355 5.46447C41.5979 4.52678 40.3261 4 39 4ZM36.728 23.356L36.688 28.706C36.6727 30.8402 35.816 32.8822 34.3038 34.3884C32.7916 35.8945 30.7463 36.7432 28.612 36.75H19.332C17.1955 36.7453 15.1474 35.8967 13.6337 34.3889C12.1199 32.8812 11.2632 30.8365 11.25 28.7V19.312C11.2616 17.1736 12.1177 15.1264 13.6319 13.6164C15.1461 12.1063 17.1956 11.2558 19.334 11.25H24.982C26.2829 11.4759 27.5175 11.9877 28.5966 12.7486C29.6757 13.5095 30.5724 14.5005 31.222 15.65C31.666 16.494 31.914 17.43 31.946 18.384C32.08 19.396 32.15 20.148 32.606 20.564C33.246 21.144 35.62 20.752 36.09 21.12L36.448 21.4L36.666 21.844L36.738 22.198L36.728 23.356Z"
                            fill="#34A853"/>
                    </svg>
                    <h2 class="ml-4 text-2xl font-bold">Devs Tutorial Center</h2>
                </a>

                <div class="hidden md:block">
                    <div class="flex items-baseline space-x-4 w-96">
                        <form id="searchForm" class="w-full" asp-controller="Search" asp-action="Index" method="post">
                            <input id="searchInput" class="w-full py-3 input" type="text" name="searchTerm" placeholder="Search" />
                        </form>
                    </div>
                </div>

                <div class="hidden md:block">
                    <div class="flex items-center ml-4 md:ml-6">
                        @if (!user.Claims.Any())
                        {
                            <div class="space-x-3 flex items-center">
                                <a asp-controller="Account" asp-action="Login" class="button-tertiary">
                                    Login
                                </a>
                                <a asp-controller="Account" asp-action="SignUp" class="button">Get Started</a>
                            </div>
                        }
                        else
                        {
                            <div class="space-x-3 flex items-center">
                                @if (user.Claims.Where(claim => claim.Type == "Role").FirstOrDefault()?.Value == "DECADEV")
                                {
                                    <a asp-controller="Articles" asp-action="CreateArticle" class="button-tertiary">
                                        Create Article
                                    </a>
                                }
                                <div class="relative inline-block text-left">
                                    <div>
                                        <button type="button" class="rounded-full w-10 object-center object-cover overflow-hidden focus:outline-none" id="dropdownButton" aria-haspopup="true" aria-expanded="true">
                                            <img src="/images/profile.svg" alt="User Picture">
                                        </button>
                                    </div>

                                    <div class="origin-top-right absolute right-0 mt-2 w-56 rounded-md shadow-lg bg-white ring-1 ring-gray-100 ring-opacity-5 hidden " id="dropdownMenu" role="menu" aria-orientation="vertical" aria-labelledby="dropdownButton">
                                        <div class="py-1" role="none">
                                            <div class="py-2 block text-sm border-b px-4">
                                                <p class="py-2 font-semibold text-gray-800">@user.Claims.Where(claim => claim.Type == "Name").FirstOrDefault()?.Value</p>
                                                <p class="text-sm text-gray-400">@user.Claims.Where(claim => claim.Type == "Role").FirstOrDefault()?.Value</p>
                                            </div>
                                            <a asp-controller="Library" asp-action="SavedArticles" class="block px-4 py-2 text-sm text-gray-700 hover:bg-gray-100 hover:text-gray-900" role="menuitem">Library</a>
                                            <a asp-controller="Story" asp-action="PublishedArticles" class="block px-4 py-2 text-sm text-gray-700 hover:bg-gray-100 hover:text-gray-900" role="menuitem">Stories</a>
                                            <a asp-controller="Account" asp-action="Logout" class="block px-4 py-2 text-sm text-gray-700 hover:bg-gray-100 hover:text-gray-900" role="menuitem">Logout</a>
                                        </div>
                                    </div>
                                </div>
                            </div>
                        }
                    </div>
                </div>
            </div>
            <div class="flex -mr-2 md:hidden">
                <!-- Mobile menu button -->
                <button type="button"
                        class="relative inline-flex items-center justify-center p-2 text-gray-400 rounded-md bg-gray-50 hover:bg-gray-200 focus:outline-none focus:ring-2 focus:ring-white focus:ring-offset-2 focus:ring-offset-gray-600"
                        aria-controls="mobile-menu" aria-expanded="false">
                    <span class="absolute -inset-0.5"></span>
                    <!-- Menu open: "hidden", Menu closed: "block" -->
                    <svg class="block w-6 h-6" fill="none" viewBox="0 0 24 24" stroke-width="1.5" stroke="currentColor"
                         aria-hidden="true">
                        <path stroke-linecap="round" stroke-linejoin="round"
                              d="M3.75 6.75h16.5M3.75 12h16.5m-16.5 5.25h16.5"/>
                    </svg>
                    <!-- Menu open: "block", Menu closed: "hidden" -->
                    <svg class="hidden w-6 h-6" fill="none" viewBox="0 0 24 24" stroke-width="1.5" stroke="currentColor"
                         aria-hidden="true">
                        <path stroke-linecap="round" stroke-linejoin="round" d="M6 18L18 6M6 6l12 12"/>
                    </svg>
                </button>
            </div>
        </div>
    </div>

    <!-- Mobile menu, show/hide based on menu state. -->
    <div class="md:hidden" id="mobile-menu">
        <div class="px-2 pt-2 pb-3 space-y-1 sm:px-3">
        </div>
        <div class="pt-4 pb-3 border-t border-gray-100">
            <div class="px-2 mt-3 space-y-1">
                <div class="flex items-baseline w-full mb-4 space-x-4">
                    <form id="mobileSearchForm" asp-controller="Search" asp-action="Index" method="post">
                        <input class="w-full py-3 input" type="text" name="searchTerm" placeholder="Search" />
                    </form>
                </div>
                @if (!user.Claims.Any())
                {
                    <a asp-controller="Account" asp-action="SignUp" class="button">Get Started</a>
                }
                else
                {
                    <a asp-controller="Articles" asp-action="CreateArticle" class="button-secondary">Create Article</a>
                }
            </div>
        </div>
    </div>
</nav>

<script>
  document.getElementById('dropdownButton').addEventListener('click', function() {
    var dropdownMenu = document.getElementById('dropdownMenu');
    dropdownMenu.classList.toggle('hidden');
  });
    
  // Attach key press event listener for search input
   document.getElementById('searchInput').addEventListener('keypress', function (event) {
        handleSearchFormSubmit(event, 'searchForm');
    });

    // Attach key press event listener for mobile search input
   document.getElementById('mobileSearchForm').addEventListener('keypress', function (event) {
        handleSearchFormSubmit(event, 'mobileSearchForm');
    });


</script>